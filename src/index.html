<!DOCTYPE html>
<head>
  <meta charset="utf-8">
  <script src="https://cdn.socket.io/4.5.4/socket.io.min.js"></script>

  <style>
    body {
      font-family: sans-serif;
      background-color: magenta;
    }
    .content {
      width: 100%;
      position: absolute;
      bottom: 0;
    }
    .message-conteiner {
      text-align: center;
      display: none;
    }
    .stroke {
      color: #333;
      text-shadow: 1px 1px 0 #fff, -1px -1px 0 #fff,
      -1px 1px 0 #fff, 1px -1px 0 #fff,
      0 1px 0 #fff, 0 -1px 0 #fff,
      -0 1px 0 #fff, 1px 0 0 #fff
    }
    .username {
      background-color: #333;
      border-radius: 10px;
      padding: 8px;
      font-size: 32px;
      color: #fff;
      vertical-align: middle;
    }
    .message {
      font-size: 64px;
      color: magenta;
      vertical-align: middle;
      margin-left: 12px;
    }
  </style>
</head>

<body>
  <div class="content">
    <ul>
      <li id="message0" class="message-conteiner"><span class="username">モバきち</span><span class="message stroke">4枚やった!</span></li>
    </ul>
  </div>
  <script>
    const socket = io();

    const messageList = document.querySelector('.content ul');
    const containerElem = document.querySelector('#message0');
    const userElem = containerElem.querySelector('.username');
    const messageElem = containerElem.querySelector('.message');

    function addMessage(msg) {
      console.log(`${msg.username}: ${msg.message}`);

      const newContainerElem = containerElem.cloneNode(true);
      newContainerElem.id = `message${(new Date()).getTime()}`;
      const newUserElem = newContainerElem.querySelector('.username');
      const newMessageElem = newContainerElem.querySelector('.message');
      messageList.insertBefore(newContainerElem, containerElem);
      newUserElem.textContent = msg.username;
      newMessageElem.style.color = msg.color ?? 'magenta';
      newMessageElem.textContent = msg.message;
      newContainerElem.style.display = 'block';

      setTimeout(() => {
        newContainerElem.remove();
      }, 3000);

      /* for debug
      setTimeout(() => {
        addMessage({
          username: "モバ吉",
          message: `${Math.floor(Math.random() * 10)}枚やった`
        });
      }, Math.floor(Math.random() * 5) * 1000);
      */
    }
    /* for debug
    addMessage({
      username: "モバ吉",
      message: `${Math.floor(Math.random() * 10)}枚やった`
    });
    */

    socket.on('message', msg => {
      addMessage(msg);
    });
</script>
</body>
</html>